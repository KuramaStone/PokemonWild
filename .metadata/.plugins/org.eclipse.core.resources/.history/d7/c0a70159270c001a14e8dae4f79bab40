package me.brook.PokemonCreator.input;

import java.awt.Component;
import java.awt.Dimension;
import java.awt.GridLayout;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.image.BufferedImage;

import javax.swing.ImageIcon;
import javax.swing.JPanel;
import javax.swing.JToggleButton;

import me.brook.PokemonCreator.world.tile.TileData;
import me.brook.PokemonCreator.world.tile.TileType;

public class TileScroller extends JPanel {
	
	private PokeMaker maker;
	
	public TileScroller(PokeMaker maker) {
		this.maker = maker;
		addTiles();
	}
	
	private void addTiles() {

		int columns = 5;
		int total = 0;
		for(TileType type : TileType.values()) {
			total += type.isAnimated() ? 1 : type.getImages().length;
		}
		int rows = total / columns;

		GridLayout grid = new GridLayout(rows, columns, 0, 2);
		this.setLayout(grid);

		for(TileType type : TileType.values()) {
			for(int j = 0; j < (type.isAnimated() ? 1 : type.getImages().length); j++) {
				BufferedImage image = type.getImages()[j];
				JToggleButton icon = new JToggleButton(new ImageIcon(image));
				icon.setSelected(maker.getCurrentTileData().getType() == type &&
						maker.getCurrentTileData().getVariant() == j);
				icon.addActionListener(getTileChanger(icon, type, j));
				this.add(icon);
				icon.setSize(new Dimension(image.getWidth(), image.getHeight()));
			}
		}
	}
	
	private ActionListener getTileChanger(Component comp, TileType type, int variant) {
		return new ActionListener() {
			
			private final TileData data = new TileData(type, variant);
			
			@Override
			public void actionPerformed(ActionEvent e) {
				unSelectOtherTiles(comp);
				TileScroller.this.maker.setCurrentType(data);
			}
		};
	}
	
	private void unSelectOtherTiles(Component exceptThis) {
		for(Component comp : getComponents()) {
			if(comp instanceof JToggleButton && comp != exceptThis) {
				((JToggleButton) comp).setSelected(false);
			}
		}
	}

}
